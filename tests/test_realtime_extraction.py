#!/usr/bin/env python3
"""
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç real-time extraction.
15 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤.
"""
import asyncio
import httpx
import json
import time
from typing import Dict, List

BASE_URL = "http://localhost:8000"

# 15 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
SCENARIOS = [
    {
        "name": "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∫–ª–∏–Ω–∏–∫–∞",
        "messages": [
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–µ–Ω—è –∑–æ–≤—É—Ç –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
            "–Ø –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –∫–ª–∏–∫—É –ó–¥–æ—Ä–æ–≤—å–µ",
            "–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –≤ —Å—Ñ–µ—Ä–µ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",
            "–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –ª–µ—á–µ–Ω–∏—è",
            "–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - –±–æ–ª—å—à–æ–π –ø–æ—Ç–æ–∫ –∑–≤–æ–Ω–∫–æ–≤",
            "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º",
            "–ù—É–∂–µ–Ω –≥–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤",
            "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π CRM –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞",
            "–ú–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω +7 495 123-45-67",
            "Email ivan@health-clinic.ru",
        ]
    },
    {
        "name": "IT –∫–æ–º–ø–∞–Ω–∏—è",
        "messages": [
            "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤",
            "–ö–æ–º–ø–∞–Ω–∏—è –¢–µ—Ö–Ω–æ–°–æ—Ñ—Ç",
            "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è",
            "–°–æ–∑–¥–∞—ë–º –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –±–∏–∑–Ω–µ—Å–∞",
            "–ù–µ —É—Å–ø–µ–≤–∞–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ª–∏–¥—ã",
            "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞",
            "–ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–∏–¥–æ–≤",
            "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AmoCRM",
            "+7 926 555-12-34",
            "alex@technosoft.ru",
        ]
    },
    {
        "name": "–†–∏—Ç–µ–π–ª –º–∞–≥–∞–∑–∏–Ω",
        "messages": [
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞",
            "–°–µ—Ç—å –º–∞–≥–∞–∑–∏–Ω–æ–≤ –ü—Ä–æ–¥—É–∫—Ç—ã 24",
            "–†–æ–∑–Ω–∏—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏",
            "–ü—Ä–æ–¥–∞—ë–º –ø—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è",
            "–ö–ª–∏–µ–Ω—Ç—ã –∑–≤–æ–Ω—è—Ç —É—Ç–æ—á–Ω–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞",
            "–•–æ—Ç–∏–º —Ä–∞–∑–≥—Ä—É–∑–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤",
            "–ë–æ—Ç –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ –Ω–∞–ª–∏—á–∏–∏ –∏ —Ü–µ–Ω–∞—Ö",
            "–ù—É–∂–Ω–∞ —Å–≤—è–∑—å —Å 1–°",
            "8 800 555-35-35",
            "maria@products24.ru",
        ]
    },
    {
        "name": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —Ñ–∏—Ä–º–∞",
        "messages": [
            "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –°–µ—Ä–≥–µ–π –ö–æ–∑–ª–æ–≤",
            "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —Ñ–∏—Ä–º–∞ –ü—Ä–∞–≤–æ–î–µ–ª",
            "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞",
            "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫",
            "–ú–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ —Ç–∏–ø–æ–≤—ã–º –≤–æ–ø—Ä–æ—Å–∞–º",
            "–ù—É–∂–Ω–∞ –ø–µ—Ä–≤–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ",
            "–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–±–ª–µ–º–µ",
            "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–∏—Ç—Ä–∏–∫—Å24",
            "+7 495 777-88-99",
            "kozlov@pravo-delo.ru",
        ]
    },
    {
        "name": "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å",
        "messages": [
            "–ü—Ä–∏–≤–µ—Ç, —è –î–º–∏—Ç—Ä–∏–π",
            "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å –ë—ã—Å—Ç—Ä—ã–π –†–µ–º–æ–Ω—Ç",
            "–†–µ–º–æ–Ω—Ç –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π",
            "–î–µ–ª–∞–µ–º –¢–û, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É, —Ä–µ–º–æ–Ω—Ç",
            "–ö–ª–∏–µ–Ω—Ç—ã —á–∞—Å—Ç–æ –∑–≤–æ–Ω—è—Ç —É–∑–Ω–∞—Ç—å —Ü–µ–Ω—ã",
            "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ —Ä–µ–º–æ–Ω—Ç",
            "–ë–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ —Ü–µ–Ω–∞—Ö",
            "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–æ–π —É—á—ë—Ç–∞",
            "8 916 222-33-44",
            "dmitry@fast-repair.ru",
        ]
    },
    {
        "name": "–§–∏—Ç–Ω–µ—Å –∫–ª—É–±",
        "messages": [
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –û–ª—å–≥–∞ –ü–µ—Ç—Ä–æ–≤–∞",
            "–§–∏—Ç–Ω–µ—Å –∫–ª—É–± –°–ø–æ—Ä—Ç–ª–∞–π—Ñ",
            "–§–∏—Ç–Ω–µ—Å –∏ wellness —É—Å–ª—É–≥–∏",
            "–¢—Ä–µ–Ω–∞–∂—ë—Ä–Ω—ã–π –∑–∞–ª, –≥—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è, –±–∞—Å—Å–µ–π–Ω",
            "–ú–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏ —Ü–µ–Ω–∞–º",
            "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ –∑–∞–Ω—è—Ç–∏—è",
            "–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏",
            "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ClubIS",
            "+7 903 111-22-33",
            "olga@sportlife.ru",
        ]
    },
    {
        "name": "–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä",
        "messages": [
            "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ï–ª–µ–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞",
            "–£—á–µ–±–Ω—ã–π —Ü–µ–Ω—Ç—Ä –ó–Ω–∞–Ω–∏–µ",
            "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",
            "–ö—É—Ä—Å—ã –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏",
            "–ú–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º –æ–±—É—á–µ–Ω–∏—è",
            "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å—ã",
            "–ë–æ—Ç –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å—ã",
            "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Moodle",
            "8 495 888-99-00",
            "elena@knowledge-center.ru",
        ]
    },
    {
        "name": "–°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏",
        "messages": [
            "–ü—Ä–∏–≤–µ—Ç, –ê–Ω–¥—Ä–µ–π –ù–æ–≤–∏–∫–æ–≤",
            "–°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –ë—ã—Å—Ç—Ä–∞—è –î–æ—Å—Ç–∞–≤–∫–∞",
            "–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞",
            "–î–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ –≥–æ—Ä–æ–¥—É",
            "–ö–ª–∏–µ–Ω—Ç—ã –∑–≤–æ–Ω—è—Ç —É–∑–Ω–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞",
            "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è",
            "–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤",
            "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–æ–π —Ç—Ä–µ–∫–∏–Ω–≥–∞",
            "+7 926 444-55-66",
            "andrey@fast-delivery.ru",
        ]
    },
    {
        "name": "–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã",
        "messages": [
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –ê–Ω–Ω–∞ –ö–æ–∑–ª–æ–≤–∞",
            "–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã –ö—Ä–∞—Å–æ—Ç–∞ –∏ –°—Ç–∏–ª—å",
            "–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∏–µ –∏ –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏",
            "–°—Ç—Ä–∏–∂–∫–∏, –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ, –º–∞–Ω–∏–∫—é—Ä, –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è",
            "–ó–≤–æ–Ω–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏",
            "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã",
            "–ë–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –∫ –º–∞—Å—Ç–µ—Ä–∞–º",
            "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YCLIENTS",
            "8 916 777-88-99",
            "anna@beauty-style.ru",
        ]
    },
    {
        "name": "–°—Ç—Ä–∞—Ö–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è",
        "messages": [
            "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ü–∞–≤–µ–ª –°–æ–∫–æ–ª–æ–≤",
            "–°—Ç—Ä–∞—Ö–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è –ù–∞–¥—ë–∂–Ω–∞—è –ó–∞—â–∏—Ç–∞",
            "–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü",
            "–û–°–ê–ì–û, –ö–ê–°–ö–û, —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∂–∏–∑–Ω–∏ –∏ –∏–º—É—â–µ—Å—Ç–≤–∞",
            "–ú–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ —Ç–∏–ø–æ–≤—ã–º –≤–æ–ø—Ä–æ—Å–∞–º",
            "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏",
            "–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏",
            "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π CRM",
            "+7 495 333-44-55",
            "pavel@reliable-insurance.ru",
        ]
    },
    {
        "name": "–ö–∞—Ñ–µ",
        "messages": [
            "–ü—Ä–∏–≤–µ—Ç, –í–∏–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤",
            "–ö–∞—Ñ–µ –í–∫—É—Å–Ω—ã–π –£–≥–æ–ª–æ–∫",
            "–û–±—â–µ–ø–∏—Ç, –∫–∞—Ñ–µ",
            "–ó–∞–≤—Ç—Ä–∞–∫–∏, –æ–±–µ–¥—ã, –±–∏–∑–Ω–µ—Å-–ª–∞–Ω—á–∏",
            "–ö–ª–∏–µ–Ω—Ç—ã –∑–≤–æ–Ω—è—Ç –∑–∞–∫–∞–∑–∞—Ç—å –µ–¥—É –Ω–∞–≤—ã–Ω–æ—Å",
            "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—ë–º –∑–∞–∫–∞–∑–æ–≤",
            "–ë–æ—Ç –¥–ª—è –ø—Ä–∏—ë–º–∞ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É",
            "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko",
            "8 903 666-77-88",
            "viktor@tasty-corner.ru",
        ]
    },
    {
        "name": "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞",
        "messages": [
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –¢–∞—Ç—å—è–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞",
            "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ –ß–µ—Ç—ã—Ä–µ –õ–∞–ø—ã",
            "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏",
            "–õ–µ—á–µ–Ω–∏–µ –∏ –≤–∞–∫—Ü–∏–Ω–∞—Ü–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö",
            "–ú–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–æ–≤ –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏—ë–º",
            "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä—É",
            "–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –ø–∏—Ç–æ–º—Ü–µ–≤",
            "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VetManager",
            "+7 926 999-00-11",
            "tatiana@four-paws.ru",
        ]
    },
    {
        "name": "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è",
        "messages": [
            "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ú–∏—Ö–∞–∏–ª –°–º–∏—Ä–Ω–æ–≤",
            "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–ª–∏–Ω–∏–∫–∞ –ë–µ–ª–æ—Å–Ω–µ–∂–∫–∞",
            "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏",
            "–õ–µ—á–µ–Ω–∏–µ, –ø—Ä–æ—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–º–ø–ª–∞–Ω—Ç–∞—Ü–∏—è",
            "–ü–∞—Ü–∏–µ–Ω—Ç—ã —á–∞—Å—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç –∑–∞–ø–∏—Å–∏",
            "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–æ–≤",
            "–ë–æ—Ç –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏—ë–º",
            "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ú–µ–¥–æ–¥–æ–º",
            "8 495 222-33-44",
            "mikhail@white-smile.ru",
        ]
    },
    {
        "name": "–†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏",
        "messages": [
            "–ü—Ä–∏–≤–µ—Ç, –†–æ–º–∞–Ω –ù–æ–≤–∏–∫–æ–≤",
            "–°–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä –¢–µ—Ö–†–µ–º–æ–Ω—Ç",
            "–†–µ–º–æ–Ω—Ç –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏",
            "–ß–∏–Ω–∏–º —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏, —Å—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã, —Ç–µ–ª–µ—Ñ–æ–Ω—ã",
            "–ö–ª–∏–µ–Ω—Ç—ã –∑–≤–æ–Ω—è—Ç —É–∑–Ω–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞",
            "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Ü–µ–Ω–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏",
            "–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∑–∞–ø–∏—Å–∏",
            "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–æ–π —É—á—ë—Ç–∞",
            "+7 916 555-66-77",
            "roman@tech-repair.ru",
        ]
    },
    {
        "name": "–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏",
        "messages": [
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –°–≤–µ—Ç–ª–∞–Ω–∞ –ö—É–∑–Ω–µ—Ü–æ–≤–∞",
            "–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –î–æ–º –ú–µ—á—Ç—ã",
            "–£—Å–ª—É–≥–∏ —Ä–∏—ç–ª—Ç–æ—Ä–∞",
            "–ü—Ä–æ–¥–∞–∂–∞, –∞—Ä–µ–Ω–¥–∞ –∫–≤–∞—Ä—Ç–∏—Ä –∏ –¥–æ–º–æ–≤",
            "–ú–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º",
            "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤–∏—á–Ω—É—é –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é",
            "–ë–æ—Ç –¥–ª—è —Å–±–æ—Ä–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏",
            "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π –±–∞–∑–æ–π –æ–±—ä–µ–∫—Ç–æ–≤",
            "8 926 111-22-33",
            "svetlana@dream-house.ru",
        ]
    },
]


async def test_scenario(scenario: Dict, scenario_num: int) -> Dict:
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–∑–≥–æ–≤–æ—Ä–∞."""
    print(f"\n{'='*60}")
    print(f"–°–¶–ï–ù–ê–†–ò–ô {scenario_num}/15: {scenario['name']}")
    print(f"{'='*60}")

    results = {
        "scenario": scenario["name"],
        "success": False,
        "errors": [],
        "extraction_count": 0,
        "fields_filled": 0,
        "messages_sent": 0,
        "extraction_times": [],
    }

    async with httpx.AsyncClient(timeout=30.0) as client:
        try:
            # 1. –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
            print("üìù –°–æ–∑–¥–∞—é —Å–µ—Å—Å–∏—é...")
            resp = await client.post(
                f"{BASE_URL}/api/session/create",
                json={"pattern": "interaction"}
            )
            if resp.status_code != 200:
                results["errors"].append(f"Failed to create session: {resp.status_code}")
                return results

            session_data = resp.json()
            session_id = session_data["session_id"]
            print(f"‚úÖ –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞: {session_id}")

            # 2. –ü–æ–¥–æ–∂–¥–∞—Ç—å –ø–æ–∫–∞ LiveKit room —Å–æ–∑–¥–∞—Å—Ç—Å—è
            await asyncio.sleep(2)

            # 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è (–∏–º–∏—Ç–∞—Ü–∏—è user transcripts)
            for i, message in enumerate(scenario["messages"], 1):
                print(f"\nüí¨ [{i}/{len(scenario['messages'])}] User: {message[:50]}...")

                # –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –∞–Ω–∫–µ—Ç—É –î–û –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
                resp_before = await client.get(f"{BASE_URL}/api/session/{session_id}/anketa")
                anketa_before = resp_before.json().get("anketa_data", {}) if resp_before.status_code == 200 else {}

                # –ò–º–∏—Ç–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ dialogue (—á–µ—Ä–µ–∑ voice agent —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
                # –î–ª—è —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Å—Ç–æ –∂–¥—ë–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ extraction –∑–∞–ø—É—Å—Ç–∏–ª—Å—è

                # –ü–æ–¥–æ–∂–¥–∞—Ç—å extraction (–≤ v5.0 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Å–ª–µ –ö–ê–ñ–î–û–ì–û —Å–æ–æ–±—â–µ–Ω–∏—è)
                print("   ‚è≥ –û–∂–∏–¥–∞—é extraction (3 —Å–µ–∫)...")
                await asyncio.sleep(3)

                # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ extraction –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
                resp_after = await client.get(f"{BASE_URL}/api/session/{session_id}/anketa")
                if resp_after.status_code != 200:
                    results["errors"].append(f"Msg {i}: Failed to get anketa")
                    continue

                anketa_after = resp_after.json().get("anketa_data", {})

                # –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π –∑–∞–ø–æ–ª–Ω–∏–ª–æ—Å—å
                filled_before = sum(1 for v in anketa_before.values() if v)
                filled_after = sum(1 for v in anketa_after.values() if v)

                if filled_after > filled_before:
                    results["extraction_count"] += 1
                    delta = filled_after - filled_before
                    print(f"   ‚úÖ Extraction –≤—ã–ø–æ–ª–Ω–µ–Ω! +{delta} –ø–æ–ª–µ–π ({filled_before} ‚Üí {filled_after})")
                else:
                    print(f"   ‚ö†Ô∏è  –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∞–Ω–∫–µ—Ç–µ (–ø–æ–ª—è: {filled_after})")

                results["messages_sent"] += 1
                results["fields_filled"] = filled_after

                # –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
                await asyncio.sleep(1)

            # 4. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
            print(f"\nüìä –ò–¢–û–ì–ò —Å—Ü–µ–Ω–∞—Ä–∏—è '{scenario['name']}':")
            print(f"   –°–æ–æ–±—â–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {results['messages_sent']}")
            print(f"   Extraction –∑–∞–ø—É—Å–∫–æ–≤: {results['extraction_count']}")
            print(f"   –ü–æ–ª–µ–π –∑–∞–ø–æ–ª–Ω–µ–Ω–æ: {results['fields_filled']}")

            # –£—Å–ø–µ—Ö –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã 50% —Å–æ–æ–±—â–µ–Ω–∏–π –≤—ã–∑–≤–∞–ª–∏ extraction
            if results['extraction_count'] >= results['messages_sent'] * 0.5:
                results['success'] = True
                print("   ‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù")
            else:
                results['success'] = False
                results['errors'].append(f"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ extraction: {results['extraction_count']}/{results['messages_sent']}")
                print("   ‚ùå –¢–ï–°–¢ –ü–†–û–í–ê–õ–ï–ù")

            # 5. –ó–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é
            await client.post(f"{BASE_URL}/api/session/{session_id}/stop")
            print(f"   üõë –°–µ—Å—Å–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")

        except Exception as e:
            results["errors"].append(f"Exception: {str(e)}")
            print(f"   ‚ùå –û–®–ò–ë–ö–ê: {e}")

    return results


async def main():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ 15 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤."""
    print("\n" + "="*60)
    print("–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï REAL-TIME EXTRACTION")
    print("15 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –±–∏–∑–Ω–µ—Å–æ–≤")
    print("="*60)

    all_results = []

    for i, scenario in enumerate(SCENARIOS, 1):
        result = await test_scenario(scenario, i)
        all_results.append(result)

        # –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
        if i < len(SCENARIOS):
            print("\n‚è∏Ô∏è  –ü–∞—É–∑–∞ 5 —Å–µ–∫ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º —Å—Ü–µ–Ω–∞—Ä–∏–µ–º...")
            await asyncio.sleep(5)

    # –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    print("\n" + "="*60)
    print("–ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –í–°–ï–ú –¢–ï–°–¢–ê–ú")
    print("="*60)

    passed = sum(1 for r in all_results if r['success'])
    failed = len(all_results) - passed

    print(f"\n‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: {passed}/{len(all_results)}")
    print(f"‚ùå –ü—Ä–æ–≤–∞–ª–∏–≤—à–∏—Ö—Å—è —Ç–µ—Å—Ç–æ–≤: {failed}/{len(all_results)}")

    if failed > 0:
        print("\n‚ùå –ü–†–û–í–ê–õ–ò–í–®–ò–ï–°–Ø –¢–ï–°–¢–´:")
        for r in all_results:
            if not r['success']:
                print(f"\n  ‚Ä¢ {r['scenario']}")
                for error in r['errors']:
                    print(f"    - {error}")

    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–∞–π–ª
    with open('/tmp/extraction_test_results.json', 'w') as f:
        json.dump(all_results, f, indent=2, ensure_ascii=False)

    print(f"\nüìÑ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: /tmp/extraction_test_results.json")

    if passed == len(all_results):
        print("\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò!")
        return 0
    else:
        print(f"\n‚ö†Ô∏è  {failed} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å")
        return 1


if __name__ == "__main__":
    exit_code = asyncio.run(main())
    exit(exit_code)
