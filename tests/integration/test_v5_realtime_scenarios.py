#!/usr/bin/env python3
"""
v5.0 Integration Test ‚Äî 15 Real Conversation Scenarios

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. Real-time extraction –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ user message
2. –ü–æ–ª—è –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
3. Sliding window optimization
4. –í—Å–µ 15 –ø–æ–ª–µ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
5. Review phase –ø—Ä–∏ 90%+ completion
"""
import asyncio
import os
import sys
from pathlib import Path

# Add project root to path
project_root = Path(__file__).parent.parent.parent
sys.path.insert(0, str(project_root))

from src.voice.consultant import VoiceConsultationSession, _check_required_fields
from src.anketa.extractor import AnketaExtractor
from src.anketa.schema import FinalAnketa
from src.llm.factory import create_llm_client


# ============================================================
# 15 –¢–ï–°–¢–û–í–´–• –°–¶–ï–ù–ê–†–ò–ï–í
# ============================================================

SCENARIOS = [
    {
        "name": "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∫–ª–∏–Ω–∏–∫–∞",
        "messages": [
            ("user", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–µ–Ω—è –∑–æ–≤—É—Ç –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"),
            ("assistant", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ò–≤–∞–Ω! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏"),
            ("user", "–Ø –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –∫–ª–∏–Ω–∏–∫—É –ó–¥–æ—Ä–æ–≤—å–µ"),
            ("assistant", "–û—Ç–ª–∏—á–Ω–æ! –í –∫–∞–∫–æ–π —Å—Ñ–µ—Ä–µ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ?"),
            ("user", "–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –≤ —Å—Ñ–µ—Ä–µ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"),
            ("assistant", "–ü–æ–Ω—è—Ç–Ω–æ. –ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏ –≤—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ?"),
            ("user", "–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –ª–µ—á–µ–Ω–∏—è"),
            ("assistant", "–ö–∞–∫–∞—è —É –≤–∞—Å –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞?"),
            ("user", "–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - –±–æ–ª—å—à–æ–π –ø–æ—Ç–æ–∫ –∑–≤–æ–Ω–∫–æ–≤"),
            ("assistant", "–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å?"),
            ("user", "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º"),
            ("assistant", "–ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω—É–∂–Ω—ã –±–æ—Ç—É?"),
            ("user", "–ù—É–∂–µ–Ω –≥–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤"),
            ("assistant", "–ö–∞–∫–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–∞–º –Ω—É–∂–Ω—ã?"),
            ("user", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π CRM –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞"),
            ("assistant", "–ö–∞–∫ —Å –≤–∞–º–∏ —Å–≤—è–∑–∞—Ç—å—Å—è?"),
            ("user", "–ú–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω +7 495 123-45-67"),
            ("assistant", "–ê email?"),
            ("user", "Email ivan@health-clinic.ru"),
            ("assistant", "–ö–∞–∫–æ–π –≥–æ–ª–æ—Å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ?"),
            ("user", "–ñ–µ–Ω—Å–∫–∏–π –≥–æ–ª–æ—Å, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω"),
        ],
        "expected_fields": {
            "contact_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
            "company_name": "–ó–¥–æ—Ä–æ–≤—å–µ",
            "industry": "–∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ",
            "contact_phone": "+7 495 123-45-67",
            "contact_email": "ivan@health-clinic.ru",
        }
    },
    {
        "name": "IT –∫–æ–º–ø–∞–Ω–∏—è",
        "messages": [
            ("user", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤"),
            ("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏"),
            ("user", "–ö–æ–º–ø–∞–Ω–∏—è –¢–µ—Ö–Ω–æ–°–æ—Ñ—Ç"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è"),
            ("assistant", "–ö–∞–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Å–æ–∑–¥–∞—ë—Ç–µ?"),
            ("user", "–°–æ–∑–¥–∞—ë–º –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –±–∏–∑–Ω–µ—Å–∞"),
            ("assistant", "–° —á–µ–º —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å?"),
            ("user", "–ù–µ —É—Å–ø–µ–≤–∞–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ª–∏–¥—ã"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å?"),
            ("user", "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞"),
            ("assistant", "–ö–∞–∫–æ–π –±–æ—Ç –≤–∞–º –Ω—É–∂–µ–Ω?"),
            ("user", "–ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–∏–¥–æ–≤"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AmoCRM"),
            ("assistant", "–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω?"),
            ("user", "+7 926 555-12-34"),
            ("assistant", "Email?"),
            ("user", "alex@technosoft.ru"),
            ("assistant", "–ö–∞–∫–æ–π –≥–æ–ª–æ—Å –∏ —Ç–æ–Ω?"),
            ("user", "–ú—É–∂—Å–∫–æ–π –≥–æ–ª–æ—Å, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ç–æ–Ω, –≤—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏"),
        ],
        "expected_fields": {
            "contact_name": "–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤",
            "company_name": "–¢–µ—Ö–Ω–æ–°–æ—Ñ—Ç",
            "industry": "IT",
            "contact_phone": "+7 926 555-12-34",
            "contact_email": "alex@technosoft.ru",
        }
    },
    {
        "name": "–†–∏—Ç–µ–π–ª –º–∞–≥–∞–∑–∏–Ω",
        "messages": [
            ("user", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞"),
            ("assistant", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –∫–æ–º–ø–∞–Ω–∏–∏"),
            ("user", "–°–µ—Ç—å –º–∞–≥–∞–∑–∏–Ω–æ–≤ –ü—Ä–æ–¥—É–∫—Ç—ã 24"),
            ("assistant", "–í –∫–∞–∫–æ–π —Å—Ñ–µ—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ?"),
            ("user", "–†–æ–∑–Ω–∏—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏"),
            ("assistant", "–ß—Ç–æ –ø—Ä–æ–¥–∞—ë—Ç–µ?"),
            ("user", "–ü—Ä–æ–¥–∞—ë–º –ø—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è"),
            ("assistant", "–ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã?"),
            ("user", "–ö–ª–∏–µ–Ω—Ç—ã –∑–≤–æ–Ω—è—Ç —É—Ç–æ—á–Ω–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞"),
            ("assistant", "–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–µ—à–∏—Ç—å?"),
            ("user", "–•–æ—Ç–∏–º —Ä–∞–∑–≥—Ä—É–∑–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤"),
            ("assistant", "–ö–∞–∫–æ–π –±–æ—Ç –Ω—É–∂–µ–Ω?"),
            ("user", "–ë–æ—Ç –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ –Ω–∞–ª–∏—á–∏–∏ –∏ —Ü–µ–Ω–∞—Ö"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ù—É–∂–Ω–∞ —Å–≤—è–∑—å —Å 1–°"),
            ("assistant", "–ö–æ–Ω—Ç–∞–∫—Ç—ã?"),
            ("user", "8 800 555-35-35"),
            ("assistant", "Email?"),
            ("user", "maria@products24.ru"),
            ("assistant", "–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ –≥–æ–ª–æ—Å—É?"),
            ("user", "–ñ–µ–Ω—Å–∫–∏–π –≥–æ–ª–æ—Å, –≤–µ–∂–ª–∏–≤—ã–π —Ç–æ–Ω"),
        ],
        "expected_fields": {
            "contact_name": "–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞",
            "company_name": "–ü—Ä–æ–¥—É–∫—Ç—ã 24",
            "industry": "—Ä–∏—Ç–µ–π–ª",
            "contact_phone": "8 800 555-35-35",
            "contact_email": "maria@products24.ru",
        }
    },
    {
        "name": "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —Ñ–∏—Ä–º–∞",
        "messages": [
            ("user", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –°–µ—Ä–≥–µ–π –ö–æ–∑–ª–æ–≤"),
            ("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –û –∫–∞–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ —Ä–∞—Å—Å–∫–∞–∂–µ—Ç–µ?"),
            ("user", "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —Ñ–∏—Ä–º–∞ –ü—Ä–∞–≤–æ–î–µ–ª"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞"),
            ("assistant", "–ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏?"),
            ("user", "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫"),
            ("assistant", "–ö–∞–∫–∏–µ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã?"),
            ("user", "–ú–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ —Ç–∏–ø–æ–≤—ã–º –≤–æ–ø—Ä–æ—Å–∞–º"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ?"),
            ("user", "–ù—É–∂–Ω–∞ –ø–µ—Ä–≤–∏—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ"),
            ("assistant", "–ö–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª?"),
            ("user", "–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–±–ª–µ–º–µ"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–∏—Ç—Ä–∏–∫—Å24"),
            ("assistant", "–ö–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è?"),
            ("user", "+7 495 777-88-99"),
            ("assistant", "Email –∞–¥—Ä–µ—Å?"),
            ("user", "kozlov@pravo-delo.ru"),
            ("assistant", "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–∞?"),
            ("user", "–ú—É–∂—Å–∫–æ–π, –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ç–æ–Ω, –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∑–≤–æ–Ω–∫–∏"),
        ],
        "expected_fields": {
            "contact_name": "–°–µ—Ä–≥–µ–π –ö–æ–∑–ª–æ–≤",
            "company_name": "–ü—Ä–∞–≤–æ–î–µ–ª",
            "industry": "—é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏",
            "contact_phone": "+7 495 777-88-99",
            "contact_email": "kozlov@pravo-delo.ru",
        }
    },
    {
        "name": "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å",
        "messages": [
            ("user", "–ü—Ä–∏–≤–µ—Ç, —è –î–º–∏—Ç—Ä–∏–π"),
            ("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–∞–∫–∞—è —É –≤–∞—Å –∫–æ–º–ø–∞–Ω–∏—è?"),
            ("user", "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å –ë—ã—Å—Ç—Ä—ã–π –†–µ–º–æ–Ω—Ç"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–†–µ–º–æ–Ω—Ç –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π"),
            ("assistant", "–ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏ –æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ?"),
            ("user", "–î–µ–ª–∞–µ–º –¢–û, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É, —Ä–µ–º–æ–Ω—Ç"),
            ("assistant", "–ö–∞–∫–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏?"),
            ("user", "–ö–ª–∏–µ–Ω—Ç—ã —á–∞—Å—Ç–æ –∑–≤–æ–Ω—è—Ç —É–∑–Ω–∞—Ç—å —Ü–µ–Ω—ã"),
            ("assistant", "–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å?"),
            ("user", "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ —Ä–µ–º–æ–Ω—Ç"),
            ("assistant", "–ö–∞–∫–æ–π –±–æ—Ç –Ω—É–∂–µ–Ω?"),
            ("user", "–ë–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ —Ü–µ–Ω–∞—Ö"),
            ("assistant", "–ö–∞–∫–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–æ–π —É—á—ë—Ç–∞"),
            ("assistant", "–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?"),
            ("user", "8 916 222-33-44"),
            ("assistant", "–ò email?"),
            ("user", "dmitry@fast-repair.ru"),
            ("assistant", "–ì–æ–ª–æ—Å –∏ —Ç–æ–Ω?"),
            ("user", "–ú—É–∂—Å–∫–æ–π, –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π, –≤—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏"),
        ],
        "expected_fields": {
            "contact_name": "–î–º–∏—Ç—Ä–∏–π",
            "company_name": "–ë—ã—Å—Ç—Ä—ã–π –†–µ–º–æ–Ω—Ç",
            "industry": "–∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å",
            "contact_phone": "8 916 222-33-44",
            "contact_email": "dmitry@fast-repair.ru",
        }
    },
    {
        "name": "–§–∏—Ç–Ω–µ—Å –∫–ª—É–±",
        "messages": [
            ("user", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –û–ª—å–≥–∞ –ü–µ—Ç—Ä–æ–≤–∞"),
            ("assistant", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –∫–æ–º–ø–∞–Ω–∏–∏"),
            ("user", "–§–∏—Ç–Ω–µ—Å –∫–ª—É–± –°–ø–æ—Ä—Ç–ª–∞–π—Ñ"),
            ("assistant", "–í –∫–∞–∫–æ–π —Å—Ñ–µ—Ä–µ?"),
            ("user", "–§–∏—Ç–Ω–µ—Å –∏ wellness —É—Å–ª—É–≥–∏"),
            ("assistant", "–ß—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç–µ?"),
            ("user", "–¢—Ä–µ–Ω–∞–∂—ë—Ä–Ω—ã–π –∑–∞–ª, –≥—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è, –±–∞—Å—Å–µ–π–Ω"),
            ("assistant", "–° —á–µ–º —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å?"),
            ("user", "–ú–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏ —Ü–µ–Ω–∞–º"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ?"),
            ("user", "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ –∑–∞–Ω—è—Ç–∏—è"),
            ("assistant", "–ö–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–æ—Ç–∞?"),
            ("user", "–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ClubIS"),
            ("assistant", "–¢–µ–ª–µ—Ñ–æ–Ω?"),
            ("user", "+7 903 111-22-33"),
            ("assistant", "Email?"),
            ("user", "olga@sportlife.ru"),
            ("assistant", "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–∞?"),
            ("user", "–ñ–µ–Ω—Å–∫–∏–π, —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π —Ç–æ–Ω, –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∑–≤–æ–Ω–∫–∏"),
        ],
        "expected_fields": {
            "contact_name": "–û–ª—å–≥–∞ –ü–µ—Ç—Ä–æ–≤–∞",
            "company_name": "–°–ø–æ—Ä—Ç–ª–∞–π—Ñ",
            "industry": "—Ñ–∏—Ç–Ω–µ—Å",
            "contact_phone": "+7 903 111-22-33",
            "contact_email": "olga@sportlife.ru",
        }
    },
    {
        "name": "–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä",
        "messages": [
            ("user", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ï–ª–µ–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞"),
            ("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –û –∫–∞–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏?"),
            ("user", "–£—á–µ–±–Ω—ã–π —Ü–µ–Ω—Ç—Ä –ó–Ω–∞–Ω–∏–µ"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"),
            ("assistant", "–ö–∞–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã?"),
            ("user", "–ö—É—Ä—Å—ã –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏"),
            ("assistant", "–ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã?"),
            ("user", "–ú–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º –æ–±—É—á–µ–Ω–∏—è"),
            ("assistant", "–ß—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å?"),
            ("user", "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å—ã"),
            ("assistant", "–§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞?"),
            ("user", "–ë–æ—Ç –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å—ã"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Moodle"),
            ("assistant", "–¢–µ–ª–µ—Ñ–æ–Ω?"),
            ("user", "8 495 888-99-00"),
            ("assistant", "Email?"),
            ("user", "elena@knowledge-center.ru"),
            ("assistant", "–ì–æ–ª–æ—Å?"),
            ("user", "–ñ–µ–Ω—Å–∫–∏–π, –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ç–æ–Ω"),
        ],
        "expected_fields": {
            "contact_name": "–ï–ª–µ–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞",
            "company_name": "–ó–Ω–∞–Ω–∏–µ",
            "industry": "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",
            "contact_phone": "8 495 888-99-00",
            "contact_email": "elena@knowledge-center.ru",
        }
    },
    {
        "name": "–°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏",
        "messages": [
            ("user", "–ü—Ä–∏–≤–µ—Ç, –ê–Ω–¥—Ä–µ–π –ù–æ–≤–∏–∫–æ–≤"),
            ("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –±–∏–∑–Ω–µ—Å–µ"),
            ("user", "–°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –ë—ã—Å—Ç—Ä–∞—è –î–æ—Å—Ç–∞–≤–∫–∞"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞"),
            ("assistant", "–ß—Ç–æ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ?"),
            ("user", "–î–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ –≥–æ—Ä–æ–¥—É"),
            ("assistant", "–ö–∞–∫–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏?"),
            ("user", "–ö–ª–∏–µ–Ω—Ç—ã –∑–≤–æ–Ω—è—Ç —É–∑–Ω–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ?"),
            ("user", "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è"),
            ("assistant", "–ö–∞–∫–æ–π –±–æ—Ç?"),
            ("user", "–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–æ–π —Ç—Ä–µ–∫–∏–Ω–≥–∞"),
            ("assistant", "–ö–æ–Ω—Ç–∞–∫—Ç—ã?"),
            ("user", "+7 926 444-55-66"),
            ("assistant", "Email?"),
            ("user", "andrey@fast-delivery.ru"),
            ("assistant", "–ì–æ–ª–æ—Å –∏ —Ç–æ–Ω?"),
            ("user", "–ú—É–∂—Å–∫–æ–π, –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ç–æ–Ω, –≤—Ö–æ–¥—è—â–∏–µ"),
        ],
        "expected_fields": {
            "contact_name": "–ê–Ω–¥—Ä–µ–π –ù–æ–≤–∏–∫–æ–≤",
            "company_name": "–ë—ã—Å—Ç—Ä–∞—è –î–æ—Å—Ç–∞–≤–∫–∞",
            "industry": "–ª–æ–≥–∏—Å—Ç–∏–∫–∞",
            "contact_phone": "+7 926 444-55-66",
            "contact_email": "andrey@fast-delivery.ru",
        }
    },
    {
        "name": "–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã",
        "messages": [
            ("user", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –ê–Ω–Ω–∞ –ö–æ–∑–ª–æ–≤–∞"),
            ("assistant", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ö–∞–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è?"),
            ("user", "–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã –ö—Ä–∞—Å–æ—Ç–∞ –∏ –°—Ç–∏–ª—å"),
            ("assistant", "–í –∫–∞–∫–æ–π —Å—Ñ–µ—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ?"),
            ("user", "–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∏–µ –∏ –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏"),
            ("assistant", "–ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏ –æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ?"),
            ("user", "–°—Ç—Ä–∏–∂–∫–∏, –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ, –º–∞–Ω–∏–∫—é—Ä, –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è"),
            ("assistant", "–ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã?"),
            ("user", "–ó–≤–æ–Ω–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ?"),
            ("user", "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã"),
            ("assistant", "–ö–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª?"),
            ("user", "–ë–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –∫ –º–∞—Å—Ç–µ—Ä–∞–º"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YCLIENTS"),
            ("assistant", "–¢–µ–ª–µ—Ñ–æ–Ω?"),
            ("user", "8 916 777-88-99"),
            ("assistant", "Email?"),
            ("user", "anna@beauty-style.ru"),
            ("assistant", "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–∞?"),
            ("user", "–ñ–µ–Ω—Å–∫–∏–π, –ø—Ä–∏—è—Ç–Ω—ã–π —Ç–æ–Ω"),
        ],
        "expected_fields": {
            "contact_name": "–ê–Ω–Ω–∞ –ö–æ–∑–ª–æ–≤–∞",
            "company_name": "–ö—Ä–∞—Å–æ—Ç–∞ –∏ –°—Ç–∏–ª—å",
            "industry": "—Å–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã",
            "contact_phone": "8 916 777-88-99",
            "contact_email": "anna@beauty-style.ru",
        }
    },
    {
        "name": "–°—Ç—Ä–∞—Ö–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è",
        "messages": [
            ("user", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ü–∞–≤–µ–ª –°–æ–∫–æ–ª–æ–≤"),
            ("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –û –∫–∞–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏?"),
            ("user", "–°—Ç—Ä–∞—Ö–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è –ù–∞–¥—ë–∂–Ω–∞—è –ó–∞—â–∏—Ç–∞"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü"),
            ("assistant", "–ö–∞–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã?"),
            ("user", "–û–°–ê–ì–û, –ö–ê–°–ö–û, —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∂–∏–∑–Ω–∏ –∏ –∏–º—É—â–µ—Å—Ç–≤–∞"),
            ("assistant", "–ö–∞–∫–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏?"),
            ("user", "–ú–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ —Ç–∏–ø–æ–≤—ã–º –≤–æ–ø—Ä–æ—Å–∞–º"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ?"),
            ("user", "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏"),
            ("assistant", "–§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞?"),
            ("user", "–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π CRM"),
            ("assistant", "–¢–µ–ª–µ—Ñ–æ–Ω?"),
            ("user", "+7 495 333-44-55"),
            ("assistant", "Email?"),
            ("user", "pavel@reliable-insurance.ru"),
            ("assistant", "–ì–æ–ª–æ—Å?"),
            ("user", "–ú—É–∂—Å–∫–æ–π, –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ç–æ–Ω, –æ–±–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"),
        ],
        "expected_fields": {
            "contact_name": "–ü–∞–≤–µ–ª –°–æ–∫–æ–ª–æ–≤",
            "company_name": "–ù–∞–¥—ë–∂–Ω–∞—è –ó–∞—â–∏—Ç–∞",
            "industry": "—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ",
            "contact_phone": "+7 495 333-44-55",
            "contact_email": "pavel@reliable-insurance.ru",
        }
    },
    {
        "name": "–ö–∞—Ñ–µ",
        "messages": [
            ("user", "–ü—Ä–∏–≤–µ—Ç, –í–∏–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤"),
            ("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –∫–æ–º–ø–∞–Ω–∏–∏"),
            ("user", "–ö–∞—Ñ–µ –í–∫—É—Å–Ω—ã–π –£–≥–æ–ª–æ–∫"),
            ("assistant", "–í –∫–∞–∫–æ–π —Å—Ñ–µ—Ä–µ?"),
            ("user", "–û–±—â–µ–ø–∏—Ç, –∫–∞—Ñ–µ"),
            ("assistant", "–ß—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç–µ?"),
            ("user", "–ó–∞–≤—Ç—Ä–∞–∫–∏, –æ–±–µ–¥—ã, –±–∏–∑–Ω–µ—Å-–ª–∞–Ω—á–∏"),
            ("assistant", "–ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã?"),
            ("user", "–ö–ª–∏–µ–Ω—Ç—ã –∑–≤–æ–Ω—è—Ç –∑–∞–∫–∞–∑–∞—Ç—å –µ–¥—É –Ω–∞–≤—ã–Ω–æ—Å"),
            ("assistant", "–ß—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å?"),
            ("user", "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—ë–º –∑–∞–∫–∞–∑–æ–≤"),
            ("assistant", "–ö–∞–∫–æ–π –±–æ—Ç –Ω—É–∂–µ–Ω?"),
            ("user", "–ë–æ—Ç –¥–ª—è –ø—Ä–∏—ë–º–∞ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko"),
            ("assistant", "–ö–æ–Ω—Ç–∞–∫—Ç—ã?"),
            ("user", "8 903 666-77-88"),
            ("assistant", "Email?"),
            ("user", "viktor@tasty-corner.ru"),
            ("assistant", "–ì–æ–ª–æ—Å?"),
            ("user", "–ú—É–∂—Å–∫–æ–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ç–æ–Ω, –≤—Ö–æ–¥—è—â–∏–µ"),
        ],
        "expected_fields": {
            "contact_name": "–í–∏–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤",
            "company_name": "–í–∫—É—Å–Ω—ã–π –£–≥–æ–ª–æ–∫",
            "industry": "–æ–±—â–µ–ø–∏—Ç",
            "contact_phone": "8 903 666-77-88",
            "contact_email": "viktor@tasty-corner.ru",
        }
    },
    {
        "name": "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞",
        "messages": [
            ("user", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –¢–∞—Ç—å—è–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞"),
            ("assistant", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ö–∞–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è?"),
            ("user", "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞ –ß–µ—Ç—ã—Ä–µ –õ–∞–ø—ã"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏"),
            ("assistant", "–ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏?"),
            ("user", "–õ–µ—á–µ–Ω–∏–µ –∏ –≤–∞–∫—Ü–∏–Ω–∞—Ü–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö"),
            ("assistant", "–ö–∞–∫–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏?"),
            ("user", "–ú–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–æ–≤ –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏—ë–º"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ?"),
            ("user", "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä—É"),
            ("assistant", "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª?"),
            ("user", "–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –ø–∏—Ç–æ–º—Ü–µ–≤"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VetManager"),
            ("assistant", "–¢–µ–ª–µ—Ñ–æ–Ω?"),
            ("user", "+7 926 999-00-11"),
            ("assistant", "Email?"),
            ("user", "tatiana@four-paws.ru"),
            ("assistant", "–ì–æ–ª–æ—Å?"),
            ("user", "–ñ–µ–Ω—Å–∫–∏–π, –∑–∞–±–æ—Ç–ª–∏–≤—ã–π —Ç–æ–Ω"),
        ],
        "expected_fields": {
            "contact_name": "–¢–∞—Ç—å—è–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞",
            "company_name": "–ß–µ—Ç—ã—Ä–µ –õ–∞–ø—ã",
            "industry": "–≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∏—è",
            "contact_phone": "+7 926 999-00-11",
            "contact_email": "tatiana@four-paws.ru",
        }
    },
    {
        "name": "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è",
        "messages": [
            ("user", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, –ú–∏—Ö–∞–∏–ª –°–º–∏—Ä–Ω–æ–≤"),
            ("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –û –∫–∞–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏?"),
            ("user", "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–ª–∏–Ω–∏–∫–∞ –ë–µ–ª–æ—Å–Ω–µ–∂–∫–∞"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏"),
            ("assistant", "–ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏ –æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ?"),
            ("user", "–õ–µ—á–µ–Ω–∏–µ, –ø—Ä–æ—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–º–ø–ª–∞–Ω—Ç–∞—Ü–∏—è"),
            ("assistant", "–ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã?"),
            ("user", "–ü–∞—Ü–∏–µ–Ω—Ç—ã —á–∞—Å—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç –∑–∞–ø–∏—Å–∏"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ?"),
            ("user", "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–æ–≤"),
            ("assistant", "–ö–∞–∫–æ–π –±–æ—Ç?"),
            ("user", "–ë–æ—Ç –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏—ë–º"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ú–µ–¥–æ–¥–æ–º"),
            ("assistant", "–¢–µ–ª–µ—Ñ–æ–Ω?"),
            ("user", "8 495 222-33-44"),
            ("assistant", "Email?"),
            ("user", "mikhail@white-smile.ru"),
            ("assistant", "–ì–æ–ª–æ—Å?"),
            ("user", "–ú—É–∂—Å–∫–æ–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω, –æ–±–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"),
        ],
        "expected_fields": {
            "contact_name": "–ú–∏—Ö–∞–∏–ª –°–º–∏—Ä–Ω–æ–≤",
            "company_name": "–ë–µ–ª–æ—Å–Ω–µ–∂–∫–∞",
            "industry": "—Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è",
            "contact_phone": "8 495 222-33-44",
            "contact_email": "mikhail@white-smile.ru",
        }
    },
    {
        "name": "–†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏",
        "messages": [
            ("user", "–ü—Ä–∏–≤–µ—Ç, –†–æ–º–∞–Ω –ù–æ–≤–∏–∫–æ–≤"),
            ("assistant", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –±–∏–∑–Ω–µ—Å–µ"),
            ("user", "–°–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä –¢–µ—Ö–†–µ–º–æ–Ω—Ç"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–†–µ–º–æ–Ω—Ç –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏"),
            ("assistant", "–ß—Ç–æ —Ä–µ–º–æ–Ω—Ç–∏—Ä—É–µ—Ç–µ?"),
            ("user", "–ß–∏–Ω–∏–º —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏, —Å—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã, —Ç–µ–ª–µ—Ñ–æ–Ω—ã"),
            ("assistant", "–ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã?"),
            ("user", "–ö–ª–∏–µ–Ω—Ç—ã –∑–≤–æ–Ω—è—Ç —É–∑–Ω–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ?"),
            ("user", "–ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Ü–µ–Ω–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏"),
            ("assistant", "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–æ—Ç–∞?"),
            ("user", "–ì–æ–ª–æ—Å–æ–≤–æ–π –±–æ—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∑–∞–ø–∏—Å–∏"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–æ–π —É—á—ë—Ç–∞"),
            ("assistant", "–ö–æ–Ω—Ç–∞–∫—Ç—ã?"),
            ("user", "+7 916 555-66-77"),
            ("assistant", "Email?"),
            ("user", "roman@tech-repair.ru"),
            ("assistant", "–ì–æ–ª–æ—Å?"),
            ("user", "–ú—É–∂—Å–∫–æ–π, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ç–æ–Ω, –≤—Ö–æ–¥—è—â–∏–µ"),
        ],
        "expected_fields": {
            "contact_name": "–†–æ–º–∞–Ω –ù–æ–≤–∏–∫–æ–≤",
            "company_name": "–¢–µ—Ö–†–µ–º–æ–Ω—Ç",
            "industry": "—Ä–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏",
            "contact_phone": "+7 916 555-66-77",
            "contact_email": "roman@tech-repair.ru",
        }
    },
    {
        "name": "–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏",
        "messages": [
            ("user", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –°–≤–µ—Ç–ª–∞–Ω–∞ –ö—É–∑–Ω–µ—Ü–æ–≤–∞"),
            ("assistant", "–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ö–∞–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è?"),
            ("user", "–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –î–æ–º –ú–µ—á—Ç—ã"),
            ("assistant", "–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å?"),
            ("user", "–£—Å–ª—É–≥–∏ —Ä–∏—ç–ª—Ç–æ—Ä–∞"),
            ("assistant", "–ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏?"),
            ("user", "–ü—Ä–æ–¥–∞–∂–∞, –∞—Ä–µ–Ω–¥–∞ –∫–≤–∞—Ä—Ç–∏—Ä –∏ –¥–æ–º–æ–≤"),
            ("assistant", "–° —á–µ–º —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å?"),
            ("user", "–ú–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–æ–≤ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º"),
            ("assistant", "–ß—Ç–æ –Ω—É–∂–Ω–æ?"),
            ("user", "–•–æ—Ç–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤–∏—á–Ω—É—é –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é"),
            ("assistant", "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–æ—Ç–∞?"),
            ("user", "–ë–æ—Ç –¥–ª—è —Å–±–æ—Ä–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏"),
            ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏?"),
            ("user", "–ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—à–µ–π –±–∞–∑–æ–π –æ–±—ä–µ–∫—Ç–æ–≤"),
            ("assistant", "–¢–µ–ª–µ—Ñ–æ–Ω?"),
            ("user", "8 926 111-22-33"),
            ("assistant", "Email?"),
            ("user", "svetlana@dream-house.ru"),
            ("assistant", "–ì–æ–ª–æ—Å?"),
            ("user", "–ñ–µ–Ω—Å–∫–∏–π, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ç–∏–≤–Ω—ã–π —Ç–æ–Ω, –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ"),
        ],
        "expected_fields": {
            "contact_name": "–°–≤–µ—Ç–ª–∞–Ω–∞ –ö—É–∑–Ω–µ—Ü–æ–≤–∞",
            "company_name": "–î–æ–º –ú–µ—á—Ç—ã",
            "industry": "–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å",
            "contact_phone": "8 926 111-22-33",
            "contact_email": "svetlana@dream-house.ru",
        }
    },
]


# ============================================================
# TEST RUNNER
# ============================================================

async def test_scenario(scenario: dict, scenario_num: int) -> dict:
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Å v5.0 extraction."""
    print(f"\n{'='*70}")
    print(f"–°–¶–ï–ù–ê–†–ò–ô {scenario_num}/15: {scenario['name']}")
    print(f"{'='*70}")

    results = {
        "scenario": scenario["name"],
        "success": False,
        "errors": [],
        "extraction_count": 0,
        "fields_progress": [],
        "completion_rates": [],
        "review_triggered": False,
    }

    try:
        # 1. –°–æ–∑–¥–∞—Ç—å consultation session
        consultation = VoiceConsultationSession(
            room_name=f"test-room-{scenario_num:02d}"
        )
        print(f"‚úÖ –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞: {consultation.session_id}")

        # 2. –°–æ–∑–¥–∞—Ç—å extractor
        llm_provider = os.getenv("LLM_PROVIDER", "deepseek")
        llm = create_llm_client(llm_provider)
        extractor = AnketaExtractor(llm)

        # 3. –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä message-by-message
        anketa_data = {}
        user_message_count = 0

        for i, (role, message) in enumerate(scenario["messages"], 1):
            # –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ dialogue
            consultation.add_message(role, message)

            # v5.0: Extraction –ø–æ—Å–ª–µ –ö–ê–ñ–î–û–ì–û user message
            if role == "user":
                user_message_count += 1
                print(f"\nüí¨ [{user_message_count}] User: {message[:60]}...")

                # –ö–†–ò–¢–ò–ß–ù–û: –º–∏–Ω–∏–º—É–º 4 —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è extraction
                if len(consultation.dialogue_history) < 4:
                    print(f"   ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ extraction (–≤—Å–µ–≥–æ {len(consultation.dialogue_history)} —Å–æ–æ–±—â–µ–Ω–∏–π)")
                    continue

                # v5.0: Sliding window (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 12 —Å–æ–æ–±—â–µ–Ω–∏–π)
                dialogue_for_extraction = consultation.dialogue_history
                is_windowed = False
                if len(consultation.dialogue_history) > 12:
                    dialogue_for_extraction = consultation.dialogue_history[-12:]
                    is_windowed = True

                # –ó–∞–ø—É—Å—Ç–∏—Ç—å extraction
                print(f"   üîç Extraction (window: {len(dialogue_for_extraction)} msgs, windowed: {is_windowed})...")

                try:
                    new_anketa = await extractor.extract(
                        dialogue_history=dialogue_for_extraction,
                    )

                    # Merge —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                    if new_anketa:
                        new_data = new_anketa.model_dump(exclude_unset=True, exclude_none=True)
                        anketa_data.update(new_data)
                        results["extraction_count"] += 1

                        # –ü–æ—Å—á–∏—Ç–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è (v5.0: 15 –ø–æ–ª–µ–π)
                        filled_count = sum(
                            1 for field in [
                                'company_name', 'industry', 'business_description',
                                'services', 'current_problems', 'business_goals',
                                'agent_name', 'agent_purpose', 'agent_functions',
                                'contact_name', 'contact_phone', 'contact_email',
                                'voice_gender', 'voice_tone', 'call_direction',
                            ]
                            if anketa_data.get(field) and (
                                (isinstance(anketa_data[field], list) and len(anketa_data[field]) > 0) or
                                (isinstance(anketa_data[field], str) and anketa_data[field].strip())
                            )
                        )

                        completion_rate = filled_count / 15
                        results["fields_progress"].append(filled_count)
                        results["completion_rates"].append(round(completion_rate, 2))

                        print(f"   ‚úÖ Extraction –≤—ã–ø–æ–ª–Ω–µ–Ω! –ü–æ–ª–µ–π: {filled_count}/15 ({int(completion_rate*100)}%)")

                        # v5.0: Review phase –ø—Ä–∏ 90%+ (14+ –ø–æ–ª–µ–π –∏–∑ 15)
                        if completion_rate >= 0.9 and not results["review_triggered"]:
                            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                            required_filled = _check_required_fields(anketa_data)
                            if required_filled:
                                results["review_triggered"] = True
                                print(f"   üéØ REVIEW PHASE TRIGGERED! (completion: {int(completion_rate*100)}%)")

                except Exception as e:
                    print(f"   ‚ùå Extraction –æ—à–∏–±–∫–∞: {e}")
                    results["errors"].append(f"Msg {user_message_count}: {str(e)}")

        # 4. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        print(f"\nüìä –ò–¢–û–ì–ò —Å—Ü–µ–Ω–∞—Ä–∏—è '{scenario['name']}':")
        print(f"   User —Å–æ–æ–±—â–µ–Ω–∏–π: {user_message_count}")
        print(f"   Extraction –∑–∞–ø—É—Å–∫–æ–≤: {results['extraction_count']}")
        print(f"   –§–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å: {results['fields_progress'][-1] if results['fields_progress'] else 0}/15")
        print(f"   Review triggered: {results['review_triggered']}")

        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å expected fields
        all_expected_found = True
        for field, expected_value in scenario["expected_fields"].items():
            actual_value = anketa_data.get(field, "")
            # Normalize phone field (–º–æ–∂–µ—Ç –±—ã—Ç—å contact_phone –∏–ª–∏ phone)
            if field == "contact_phone" and not actual_value:
                actual_value = anketa_data.get("phone", "")
            # Normalize email field
            if field == "contact_email" and not actual_value:
                actual_value = anketa_data.get("email", "")

            if not actual_value or expected_value.lower() not in str(actual_value).lower():
                all_expected_found = False
                print(f"   ‚ö†Ô∏è  –ü–æ–ª–µ '{field}': –æ–∂–∏–¥–∞–ª–æ—Å—å '{expected_value}', –ø–æ–ª—É—á–µ–Ω–æ '{actual_value}'")

        # –£—Å–ø–µ—Ö –µ—Å–ª–∏:
        # 1. Extraction –∑–∞–ø—É—Å–∫–∞–ª—Å—è —Ö–æ—Ç—è –±—ã 3 —Ä–∞–∑–∞ (real-time)
        # 2. –ó–∞–ø–æ–ª–Ω–µ–Ω–æ —Ö–æ—Ç—è –±—ã 10+ –ø–æ–ª–µ–π
        # 3. –í—Å–µ expected fields –Ω–∞–π–¥–µ–Ω—ã
        final_fields_count = results['fields_progress'][-1] if results['fields_progress'] else 0
        if results['extraction_count'] >= 3 and \
           final_fields_count >= 10 and \
           all_expected_found:
            results['success'] = True
            print(f"   ‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù")
        else:
            results['success'] = False
            if results['extraction_count'] < 3:
                results['errors'].append(f"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ extraction: {results['extraction_count']} (–Ω—É–∂–Ω–æ >= 3)")
            if final_fields_count < 10:
                results['errors'].append(f"–ú–∞–ª–æ –ø–æ–ª–µ–π –∑–∞–ø–æ–ª–Ω–µ–Ω–æ: {final_fields_count}/15 (–Ω—É–∂–Ω–æ >= 10)")
            if not all_expected_found:
                results['errors'].append("–ù–µ –≤—Å–µ expected fields –Ω–∞–π–¥–µ–Ω—ã")
            print(f"   ‚ùå –¢–ï–°–¢ –ü–†–û–í–ê–õ–ï–ù")

    except Exception as e:
        results["errors"].append(f"Exception: {str(e)}")
        print(f"   ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: {e}")
        import traceback
        traceback.print_exc()

    return results


async def main():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ 15 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤."""
    print("\n" + "="*70)
    print("v5.0 INTEGRATION TEST ‚Äî 15 REAL CONVERSATION SCENARIOS")
    print("="*70)
    print("\n–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:")
    print("  1. ‚úÖ Real-time extraction –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ user message")
    print("  2. ‚úÖ –ü–æ–ª—è –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ")
    print("  3. ‚úÖ Sliding window optimization (last 12 messages)")
    print("  4. ‚úÖ –í—Å–µ 15 –ø–æ–ª–µ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã")
    print("  5. ‚úÖ Review phase –ø—Ä–∏ 90%+ completion")
    print("="*70)

    all_results = []

    for i, scenario in enumerate(SCENARIOS, 1):
        result = await test_scenario(scenario, i)
        all_results.append(result)

    # –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    print("\n" + "="*70)
    print("–ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –í–°–ï–ú –¢–ï–°–¢–ê–ú")
    print("="*70)

    passed = sum(1 for r in all_results if r['success'])
    failed = len(all_results) - passed

    print(f"\n‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: {passed}/{len(all_results)}")
    print(f"‚ùå –ü—Ä–æ–≤–∞–ª–∏–≤—à–∏—Ö—Å—è —Ç–µ—Å—Ç–æ–≤: {failed}/{len(all_results)}")

    if failed > 0:
        print("\n‚ùå –ü–†–û–í–ê–õ–ò–í–®–ò–ï–°–Ø –¢–ï–°–¢–´:")
        for r in all_results:
            if not r['success']:
                print(f"\n  ‚Ä¢ {r['scenario']}")
                for error in r['errors']:
                    print(f"    - {error}")
                print(f"    Extraction count: {r['extraction_count']}")
                print(f"    Fields progress: {r['fields_progress']}")
                print(f"    Completion rates: {r['completion_rates']}")
                print(f"    Review triggered: {r['review_triggered']}")

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ v5.0 features
    print("\n" + "="*70)
    print("v5.0 FEATURES VERIFICATION")
    print("="*70)

    total_extractions = sum(r['extraction_count'] for r in all_results)
    avg_extractions = total_extractions / len(all_results) if all_results else 0
    review_triggered_count = sum(1 for r in all_results if r['review_triggered'])

    print(f"\n1. Real-time extraction:")
    print(f"   Total extractions: {total_extractions}")
    print(f"   Avg per scenario: {avg_extractions:.1f}")
    print(f"   ‚úÖ Extraction –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ user message: {'–î–ê' if avg_extractions >= 3 else '–ù–ï–¢'}")

    print(f"\n2. Progressive field filling:")
    for r in all_results[:3]:  # –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—ã–µ 3 —Å—Ü–µ–Ω–∞—Ä–∏—è
        if r['fields_progress']:
            print(f"   {r['scenario']}: {' ‚Üí '.join(map(str, r['fields_progress']))}/15")

    print(f"\n3. Review phase (90%+ completion):")
    print(f"   Triggered: {review_triggered_count}/{len(all_results)} scenarios")
    print(f"   ‚úÖ Review –ø—Ä–∏ 90%+: {'–î–ê' if review_triggered_count >= passed * 0.5 else '–ù–ï–¢'}")

    if passed == len(all_results):
        print("\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò!")
        print("\nv5.0 Real-time extraction —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:")
        print("  ‚úÖ Extraction –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ user message")
        print("  ‚úÖ –ü–æ–ª—è –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ")
        print("  ‚úÖ Sliding window optimization —Ä–∞–±–æ—Ç–∞–µ—Ç")
        print("  ‚úÖ –í—Å–µ 15 –ø–æ–ª–µ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã")
        print("  ‚úÖ Review phase –ø—Ä–∏ 90%+ completion")
        return 0
    else:
        print(f"\n‚ö†Ô∏è  {failed} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å")
        return 1


if __name__ == "__main__":
    exit_code = asyncio.run(main())
    sys.exit(exit_code)
