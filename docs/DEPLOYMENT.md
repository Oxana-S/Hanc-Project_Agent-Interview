# –î–µ–ø–ª–æ–π

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é Hanc.AI Voice Consultant –≤ production-—Å—Ä–µ–¥–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        Production                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ   ‚îÇ   Nginx     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  FastAPI    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Redis     ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   (proxy)   ‚îÇ    ‚îÇ  (uvicorn)  ‚îÇ    ‚îÇ  (sessions) ‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ          ‚îÇ                  ‚îÇ                  ‚îÇ           ‚îÇ
‚îÇ          ‚îÇ                  ‚îÇ                  ‚ñº           ‚îÇ
‚îÇ          ‚îÇ                  ‚îÇ           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ          ‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ PostgreSQL  ‚îÇ   ‚îÇ
‚îÇ          ‚îÇ                              ‚îÇ  (anketas)  ‚îÇ   ‚îÇ
‚îÇ          ‚îÇ                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ          ‚ñº                                                 ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ   ‚îÇ  LiveKit    ‚îÇ‚óÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Voice     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Azure     ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   Cloud     ‚îÇ    ‚îÇ   Agent     ‚îÇ    ‚îÇ   OpenAI    ‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –§–∞–π–ª | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è |
|---------|----------|------|-------------------|
| Docker Compose (Dev) | Redis + PostgreSQL + –æ—Ç–ª–∞–¥–∫–∞ | `config/docker-compose.yml` | –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ |
| Docker Compose (Prod) | Nginx + Certbot + Web + Agent + Redis + PostgreSQL | `docker-compose.yml` (–∫–æ—Ä–µ–Ω—å) | Staging, Production |
| Kubernetes | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä | ‚Äî | –ë–æ–ª—å—à–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ |
| Managed Services | LiveKit Cloud + Azure + RDS | ‚Äî | –ú–∏–Ω–∏–º—É–º ops |

## Docker Compose (Development/Staging)

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (Redis + PostgreSQL)
docker compose -f config/docker-compose.yml up -d

# –° –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –æ—Ç–ª–∞–¥–∫–∏ (pgAdmin, Redis Commander)
docker compose -f config/docker-compose.yml --profile tools up -d
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
docker compose -f config/docker-compose.yml ps
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:

```
NAME                          STATUS           PORTS
voice_interviewer_postgres    Up (healthy)     0.0.0.0:5432->5432/tcp
voice_interviewer_redis       Up (healthy)     0.0.0.0:6379->6379/tcp
```

### 3. –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | URL | –õ–æ–≥–∏–Ω |
|------------|-----|-------|
| pgAdmin | http://localhost:5050 | admin@example.com / admin |
| Redis Commander | http://localhost:8081 | ‚Äî |

### 4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker compose -f config/docker-compose.yml down

# –° —É–¥–∞–ª–µ–Ω–∏–µ–º volumes (–æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
docker compose -f config/docker-compose.yml down -v
```

## Docker Compose (Production)

–ö–æ—Ä–Ω–µ–≤–æ–π `docker-compose.yml` –ø–æ–¥–Ω–∏–º–∞–µ—Ç **–≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ü–µ–ª–∏–∫–æ–º** ‚Äî 6 —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –µ–¥–∏–Ω–æ–π —Å–µ—Ç–∏ `hanc_network`:

| –°–µ—Ä–≤–∏—Å | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------|----------|
| `nginx` | `hanc_nginx` | Reverse proxy, SSL termination (–ø–æ—Ä—Ç—ã 80/443) |
| `certbot` | `hanc_certbot` | –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 12—á) |
| `web` | `hanc_web` | FastAPI —Å–µ—Ä–≤–µ—Ä (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 8000) |
| `agent` | `hanc_agent` | –ì–æ–ª–æ—Å–æ–≤–æ–π –∞–≥–µ–Ω—Ç (LiveKit worker) |
| `redis` | `hanc_redis` | –ö—ç—à —Å–µ—Å—Å–∏–π (Redis 7, healthcheck) |
| `postgres` | `hanc_postgres` | –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç (PostgreSQL 16, healthcheck) |

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# –ó–∞–ø–æ–ª–Ω–∏—Ç–µ .env (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: DOMAIN, POSTGRES_PASSWORD, API –∫–ª—é—á–∏)
cp .env.example .env
nano .env
```

–ö–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è production:

```env
DOMAIN=your-domain.com
POSTGRES_PASSWORD=<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_–ø–∞—Ä–æ–ª—å_32_—Å–∏–º–≤–æ–ª–∞>
POSTGRES_USER=interviewer_user
POSTGRES_DB=voice_interviewer
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Let's Encrypt
./scripts/init-letsencrypt.sh
```

### 3. –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö 6 —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose logs -f web
docker compose logs -f agent
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ `docker compose ps`:

```
NAME             STATUS           PORTS
hanc_nginx       Up               0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp
hanc_certbot     Up
hanc_web         Up
hanc_agent       Up
hanc_redis       Up (healthy)
hanc_postgres    Up (healthy)
```

### 4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# Graceful stop
docker compose down

# –° —É–¥–∞–ª–µ–Ω–∏–µ–º volumes (–í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ –ë–î!)
docker compose down -v
```

### 5. Volumes

| Volume | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ |
|--------|-----------|
| `app_data` | SQLite –±–∞–∑–∞ (`data/sessions.db`) |
| `app_logs` | –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`logs/`) |
| `app_output` | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π (`output/`) |
| `redis_data` | Redis AOF persistence |
| `postgres_data` | –î–∞–Ω–Ω—ã–µ PostgreSQL |

### –û—Ç–ª–∏—á–∏–µ –æ—Ç dev-compose

| | `config/docker-compose.yml` (Dev) | `docker-compose.yml` (Prod) |
|---|---|---|
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –¢–æ–ª—å–∫–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | –í—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| **–°–µ—Ä–≤–∏—Å—ã** | Redis, PostgreSQL, pgAdmin, Redis Commander | Nginx, Certbot, Web, Agent, Redis, PostgreSQL |
| **–ü–æ—Ä—Ç—ã –Ω–∞—Ä—É–∂—É** | 6379, 5432, 5050, 8081 | 80, 443 |
| **SSL** | –ù–µ—Ç | Let's Encrypt (Nginx + Certbot) |
| **Web/Agent** | –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é | –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö |
| **–û—Ç–ª–∞–¥–∫–∞** | pgAdmin, Redis Commander (--profile tools) | –ù–µ—Ç |

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (Development)

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `scripts/hanc.sh`:

```bash
# –ó–∞–ø—É—Å–∫
./venv/bin/python scripts/run_server.py          # –¢–µ—Ä–º–∏–Ω–∞–ª 1: Web server
./scripts/hanc.sh start                          # –¢–µ—Ä–º–∏–Ω–∞–ª 2: Voice agent (—Ñ–æ–Ω–æ–º)

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
./scripts/hanc.sh status                         # –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
./scripts/hanc.sh logs                           # –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞ (tail -f)

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ / –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
./scripts/hanc.sh restart                        # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞
./scripts/hanc.sh stop                           # Graceful stop
./scripts/hanc.sh kill-all                       # –ê–≤–∞—Ä–∏–π–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
```

–ê–≥–µ–Ω—Ç –∑–∞—â–∏—â—ë–Ω –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ PID-—Ñ–∞–π–ª (`.agent.pid`).

## Production Checklist

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ü–µ—Ä–µ–¥ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –≤ production –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫–æ –≤—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º.

```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (—Å–º. docs/TESTING.md ‚Üí –≠—Ç–∞–ø 5)
# DeepSeek API
python -c "import asyncio; from src.llm.deepseek import DeepSeekClient; asyncio.run(DeepSeekClient().chat([{'role':'user','content':'ping'}])); print('‚úÖ DeepSeek')"

# Redis (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
python -c "import redis; r=redis.from_url('redis://localhost:6379'); r.ping(); print('‚úÖ Redis')"

# PostgreSQL (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
python -c "from sqlalchemy import create_engine, text; e=create_engine('postgresql://interviewer_user:change_me_in_production@localhost:5432/voice_interviewer'); e.connect().execute(text('SELECT 1')); print('‚úÖ PostgreSQL')"

# LiveKit
python -c "import asyncio,os; from dotenv import load_dotenv; from livekit import api; load_dotenv(); lk=api.LiveKitAPI(os.getenv('LIVEKIT_URL'),os.getenv('LIVEKIT_API_KEY'),os.getenv('LIVEKIT_API_SECRET')); asyncio.run(lk.room.list_rooms(api.ListRoomsRequest())); print('‚úÖ LiveKit')"
```

üìñ **–ü–æ–¥—Ä–æ–±–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ troubleshooting:** [TESTING.md#—ç—Ç–∞–ø-5-–ø—Ä–æ–≤–µ—Ä–∫–∞-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π-–∫-—Å–µ—Ä–≤–∏—Å–∞–º](TESTING.md#—ç—Ç–∞–ø-5-–ø—Ä–æ–≤–µ—Ä–∫–∞-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π-–∫-—Å–µ—Ä–≤–∏—Å–∞–º)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- [ ] –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ `.env` (POSTGRES_PASSWORD, PGADMIN_PASSWORD)
- [ ] –û—Ç–∫–ª—é—á–∏—Ç—å pgAdmin –∏ Redis Commander –≤ production
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS (—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt –∏–ª–∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ)
- [ ] –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º 5432, 6379 —á–µ—Ä–µ–∑ firewall
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å secrets manager (Vault, AWS Secrets Manager) –≤–º–µ—Å—Ç–æ `.env`

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# === –ü—Ä–æ–¥–∞–∫—à–µ–Ω –∑–Ω–∞—á–µ–Ω–∏—è ===
POSTGRES_PASSWORD=<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_–ø–∞—Ä–æ–ª—å_32_—Å–∏–º–≤–æ–ª–∞>
POSTGRES_USER=interviewer_prod
POSTGRES_DB=voice_interviewer_prod

# === API –∫–ª—é—á–∏ ===
DEEPSEEK_API_KEY=sk-...
LIVEKIT_API_KEY=API...
LIVEKIT_API_SECRET=...
AZURE_OPENAI_API_KEY=...

# === URLs ===
LIVEKIT_URL=wss://your-project.livekit.cloud
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
```

### –ë—ç–∫–∞–ø—ã

```bash
# PostgreSQL backup
docker exec voice_interviewer_postgres pg_dump -U interviewer_user voice_interviewer > backup_$(date +%Y%m%d).sql

# Redis backup (RDB snapshot)
docker exec voice_interviewer_redis redis-cli BGSAVE
docker cp voice_interviewer_redis:/data/dump.rdb ./redis_backup_$(date +%Y%m%d).rdb
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –ê–ª–µ—Ä—Ç –ø–æ—Ä–æ–≥ |
|---------|----------|-------------|
| API latency | FastAPI middleware | > 2s |
| Active sessions | Redis KEYS count | > 1000 |
| PostgreSQL connections | pg_stat_activity | > 80% max |
| Voice agent errors | logs/agent.log | > 5/min |
| LiveKit room failures | LiveKit Cloud dashboard | > 1% |

## Nginx –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```nginx
upstream fastapi {
    server 127.0.0.1:8000;
}

server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    # Security headers
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";

    location / {
        proxy_pass http://fastapi;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 300s;
    }

    location /static/ {
        alias /app/public/;
        expires 1d;
    }
}
```

## Systemd Service

### FastAPI Server

```ini
# /etc/systemd/system/hanc-api.service
[Unit]
Description=Hanc.AI Voice Consultant API
After=network.target postgresql.service redis.service

[Service]
Type=exec
User=hanc
Group=hanc
WorkingDirectory=/opt/hanc-voice-consultant
Environment="PATH=/opt/hanc-voice-consultant/venv/bin"
EnvironmentFile=/opt/hanc-voice-consultant/.env
ExecStart=/opt/hanc-voice-consultant/venv/bin/uvicorn src.web.server:app --host 0.0.0.0 --port 8000 --workers 4
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

### Voice Agent

```ini
# /etc/systemd/system/hanc-agent.service
[Unit]
Description=Hanc.AI Voice Agent
After=network.target hanc-api.service

[Service]
Type=exec
User=hanc
Group=hanc
WorkingDirectory=/opt/hanc-voice-consultant
Environment="PATH=/opt/hanc-voice-consultant/venv/bin"
EnvironmentFile=/opt/hanc-voice-consultant/.env
ExecStart=/opt/hanc-voice-consultant/venv/bin/python scripts/run_voice_agent.py prod
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫
sudo systemctl start hanc-api hanc-agent

# –°—Ç–∞—Ç—É—Å
sudo systemctl status hanc-api hanc-agent

# –õ–æ–≥–∏
sudo journalctl -u hanc-api -f
sudo journalctl -u hanc-agent -f

# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl enable hanc-api hanc-agent
```

## Health Checks

### API Health Endpoint

```bash
curl http://localhost:8000/health
# Expected: {"status": "ok", "redis": "connected", "postgres": "connected"}
```

### Agent Health (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π endpoint)

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API (PID-—Ñ–∞–π–ª + pgrep fallback)
curl http://localhost:8000/api/agent/health
# Expected: {"worker_alive": true, "worker_pid": 12345}
```

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∞–≥–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏.

### Agent Health (CLI)

```bash
# –ß–µ—Ä–µ–∑ hanc.sh (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è dev)
./scripts/hanc.sh status

# –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
pgrep -f "run_voice_agent.py"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏
tail -n 100 logs/agent.log | grep -i error
```

### LiveKit-–∫–æ–º–Ω–∞—Ç—ã

```bash
# –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç
curl http://localhost:8000/api/rooms

# –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∫–æ–º–Ω–∞—Ç
curl -X DELETE http://localhost:8000/api/rooms

# CLI-—Å–∫—Ä–∏–ø—Ç
./venv/bin/python scripts/cleanup_rooms.py --force
```

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–º–Ω–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è.

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ API

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers
uvicorn src.web.server:app --workers 8
```

### –ù–µ—Å–∫–æ–ª—å–∫–æ Voice Agents

LiveKit –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π dispatch –∞–≥–µ–Ω—Ç–æ–≤. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤:

```bash
# –ê–≥–µ–Ω—Ç 1 (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ A)
python scripts/run_voice_agent.py prod

# –ê–≥–µ–Ω—Ç 2 (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ B)
python scripts/run_voice_agent.py prod
```

LiveKit –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç –∫–æ–º–Ω–∞—Ç—ã –º–µ–∂–¥—É –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏.

## Troubleshooting

| –ü—Ä–æ–±–ª–µ–º–∞ | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|-------------|---------|
| PostgreSQL connection refused | `docker logs voice_interviewer_postgres` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ POSTGRES_PASSWORD –≤ .env |
| Redis timeout | `redis-cli -h localhost ping` | –£–≤–µ–ª–∏—á—å—Ç–µ timeout –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å |
| Agent –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è | `tail -f logs/agent.log` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ LIVEKIT_* –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ |
| 502 Bad Gateway | `sudo systemctl status hanc-api` | –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ uvicorn –∑–∞–ø—É—â–µ–Ω |

## –î–æ–∫—É–º–µ–Ω—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ (input/)

–ü—Ä–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–ø–∫–∞ `input/` –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ —á—Ç–µ–Ω–∏—è:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
mkdir -p /opt/hanc-voice-consultant/input
chown hanc:hanc /opt/hanc-voice-consultant/input
chmod 750 /opt/hanc-voice-consultant/input
```

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è max 50 MB –Ω–∞ —Ñ–∞–π–ª)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOCX, XLSX, MD, TXT
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è retention 30 –¥–Ω–µ–π)
- –î–æ–∫—É–º–µ–Ω—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (PyMuPDF, python-docx, openpyxl) ‚Äî –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

## –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [DOCKER.md](DOCKER.md) ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ Docker-–∫–æ–º–∞–Ω–¥ (production docker-compose)
- [QUICKSTART.md](QUICKSTART.md) ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [VOICE_AGENT.md](VOICE_AGENT.md) ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- [LOGGING.md](LOGGING.md) ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [ERROR_HANDLING.md](ERROR_HANDLING.md) ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
